┌─────────────────────────────────────────────────────────────────────────────────┐
│                        DUBAI REAL ESTATE PRICE PREDICTION                       │
│                              ML PIPELINE OVERVIEW                               │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│ PHASE 1: DATA INGESTION                                                         │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│   Transactions.csv ──────► PySpark DataFrame                                    │
│   (~1.6M records)          (47 columns)                                         │
│                                                                                 │
│   Key columns loaded:                                                           │
│   • actual_worth (target)    • property_type_en    • area_name_en               │
│   • trans_group_en           • procedure_area      • instance_date              │
│   • property_usage_en        • has_parking         • nearest_metro/mall_en      │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│ PHASE 2: DATA CLEANING                                                          │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐      │
│   │  Remove     │───►│  Filter to  │───►│  Handle     │───►│  Handle     │      │
│   │  Duplicates │    │  "Sales"    │    │  Outliers   │    │  Missing    │      │
│   └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘      │
│                                                                                 │
│   ~1.6M ──────────► ~800K ──────────► ~750K ──────────► ~700K records           │
│                     (Sales only)      (IQR filter)      (cleaned)               │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│ PHASE 3: FEATURE ENGINEERING                                                    │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│   ┌──────────────────┐         ┌──────────────────┐         ┌────────────────┐  │
│   │ TEMPORAL FEATURES│         │CATEGORICAL ENCODE│         │ ASSEMBLE       │  │
│   │                  │         │                  │         │                │  │
│   │ instance_date ──►│         │ StringIndexer ──►│         │ All features ─►│  │
│   │  • year          │         │ OneHotEncoder    │         │ VectorAssembler│  │
│   │  • month         │         │                  │         │                │  │
│   │  • quarter       │         │ • property_type  │         │ Output:        │  │
│   │  • day_of_week   │         │ • property_usage │         │ "features"     │  │
│   │  • is_weekend    │         │ • area_name      │         │ "label"        │  │
│   └──────────────────┘         │ • nearest_metro  │         └────────────────┘  │
│                                │ • nearest_mall   │                             │
│   ┌──────────────────┐         └──────────────────┘                             │
│   │ NUMERIC FEATURES │                                                          │
│   │ • procedure_area │                                                          │
│   │ • has_parking    │                                                          │
│   └──────────────────┘                                                          │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│ PHASE 4: DATA SPLITTING                                                         │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│                         Full Dataset (~700K)                                    │
│                                │                                                │
│                    ┌───────────┴───────────┐                                    │
│                    │                       │                                    │
│                    ▼                       ▼                                    │
│          ┌─────────────────┐     ┌─────────────────┐                            │
│          │  TRAINING SET   │     │  HOLDOUT TEST   │                            │
│          │     (80%)       │     │     (20%)       │                            │
│          │   ~560K rows    │     │   ~140K rows    │                            │
│          └─────────────────┘     └─────────────────┘                            │
│                    │                       │                                    │
│                    │                       │  ◄── NEVER TOUCHED                 │
│                    ▼                       │      DURING TRAINING               │
│          Used for 10-Fold CV               │                                    │
│          & Model Training                  ▼                                    │
│                                   Final Evaluation Only                         │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│ PHASE 5: 10-FOLD CROSS-VALIDATION (FROM SCRATCH)                                │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│   Training Set (80%)                                                            │
│   ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┬─────┐                 │
│   │  1  │  2  │  3  │  4  │  5  │  6  │  7  │  8  │  9  │ 10  │                 │
│   └─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┴─────┘                 │
│                                                                                 │
│   Fold 1:  [VAL][ TRAIN ][ TRAIN ][ TRAIN ][ TRAIN ]...  ──► metrics_1         │
│   Fold 2:  [ TRAIN ][VAL][ TRAIN ][ TRAIN ][ TRAIN ]...  ──► metrics_2         │
│   Fold 3:  [ TRAIN ][ TRAIN ][VAL][ TRAIN ][ TRAIN ]...  ──► metrics_3         │
│   ...                                                                           │
│   Fold 10: [ TRAIN ][ TRAIN ][ TRAIN ][ TRAIN ]...[VAL]  ──► metrics_10        │
│                                                                                 │
│   Final: avg(metrics_1...10) ± std(metrics_1...10)                              │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│ PHASE 6: MODEL TRAINING                                                         │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │                        BASELINE MODELS (MLlib)                          │   │
│   ├─────────────────────────────────────────────────────────────────────────┤   │
│   │                                                                         │   │
│   │   ┌──────────────┐    ┌──────────────┐    ┌──────────────┐              │   │
│   │   │   Linear     │    │  Decision    │    │   Random     │              │   │
│   │   │  Regression  │    │    Tree      │    │   Forest     │              │   │
│   │   └──────────────┘    └──────────────┘    └──────────────┘              │   │
│   │                                                                         │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │                  CUSTOM BAGGING ENSEMBLE (FROM SCRATCH)                 │   │
│   ├─────────────────────────────────────────────────────────────────────────┤   │
│   │                                                                         │   │
│   │   Training Data                                                         │   │
│   │        │                                                                │   │
│   │        ├──► Bootstrap Sample 1 ──► DecisionTree_1 ──┐                   │   │
│   │        ├──► Bootstrap Sample 2 ──► DecisionTree_2 ──┤                   │   │
│   │        ├──► Bootstrap Sample 3 ──► DecisionTree_3 ──┼──► AVERAGE ──► Prediction
│   │        │         ...                    ...         │                   │   │
│   │        └──► Bootstrap Sample N ──► DecisionTree_N ──┘                   │   │
│   │                                                                         │   │
│   │   Bootstrap: Sample WITH REPLACEMENT (same size as original)            │   │
│   │   Aggregation: Mean of all tree predictions                             │   │
│   │                                                                         │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│ PHASE 7: FINAL EVALUATION                                                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│   Best Model (from CV) ──────────────► Holdout Test Set (20%)                   │
│                                               │                                 │
│                                               ▼                                 │
│                                   ┌───────────────────┐                         │
│                                   │     METRICS       │                         │
│                                   ├───────────────────┤                         │
│                                   │ • RMSE            │                         │
│                                   │ • MAE             │                         │
│                                   │ • R² Score        │                         │
│                                   │ • MAPE            │                         │
│                                   └───────────────────┘                         │
│                                                                                 │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │                          VISUALIZATIONS                                 │   │
│   ├─────────────────────────────────────────────────────────────────────────┤   │
│   │  • Model Comparison Bar Charts (RMSE, R²)                               │   │
│   │  • Predicted vs Actual Scatter Plot                                     │   │
│   │  • Residual Analysis Plots                                              │   │
│   │  • Feature Importance Chart                                             │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────────┐
│                              SOURCE FILE MAPPING                                │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│   Phase 1  ──►  src/data_ingestion.py                                           │
│   Phase 2  ──►  src/data_cleaning.py                                            │
│   Phase 3  ──►  src/feature_engineering.py                                      │
│   Phase 5  ──►  src/cross_validation.py     ◄── FROM SCRATCH (no CrossValidator)│
│   Phase 6  ──►  src/bagging_ensemble.py     ◄── FROM SCRATCH (no RandomForest)  │
│   Phase 7  ──►  src/evaluation.py                                               │
│                                                                                 │
│   Orchestration: notebooks/bigboyz.ipynb                                        │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
